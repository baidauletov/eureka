{"version":3,"sources":["webpack://ideal-succotash/./src/components/sortable-list/index.js","webpack://ideal-succotash/./src/utils/escape-html.js","webpack://ideal-succotash/./src/components/product-form/index.js","webpack://ideal-succotash/./src/pages/products/list/index.js","webpack://ideal-succotash/./src/utils/fetch-json.js"],"names":["SortableList","constructor","items","clientX","clientY","this","moveDraggingAt","firstElementChild","children","element","top","firstElementTop","getBoundingClientRect","bottom","movePlaceholderAt","length","i","li","draggingElem","offsetHeight","height","scrollIfCloseToWindowEdge","dragStop","render","document","createElement","className","addItems","initEventListeners","addEventListener","event","onPointerDown","item","classList","add","append","which","itemElem","target","closest","preventDefault","dragStart","remove","elementInitialIndex","indexOf","pointerInitialShift","x","y","placeholderElem","style","width","offsetWidth","after","onDocumentPointerMove","onDocumentPointerUp","left","window","scrollBy","documentElement","clientHeight","index","currentElement","insertBefore","placeholderIndex","replaceWith","removeEventListener","dispatchEvent","CustomEvent","bubbles","details","from","to","destroy","string","replace","ProductForm","productId","title","description","quantity","subcategory","status","images","price","discount","save","fileInput","type","accept","onchange","async","file","files","formData","FormData","uploadImage","imageListContainer","subElements","disabled","result","fetchJson","method","headers","Authorization","body","getImageItem","data","link","name","hidden","appendChild","click","template","createCategoriesSelect","defaultFormData","categoriesPromise","loadCategoriesList","productPromise","loadProductData","Promise","resolve","categoriesData","productResponse","all","productData","categories","renderForm","setFormData","createImagesList","innerHTML","getEmptyTemplate","getSubElements","product","getFormData","JSON","stringify","id","productForm","excludedFields","formatToNumber","fields","Object","keys","filter","includes","values","field","parseInt","value","imagesHTMLCollection","querySelectorAll","image","push","url","src","source","alt","detail","forEach","querySelector","wrapper","select","category","child","subcategories","Option","outerHTML","elements","dataset","map","sortableList","escapeHtml","onSubmit","Page","initComponents","renderComponents","components","productFrom","component","params","response","fetch","toString","err","FetchError","ok","errorText","statusText","json","error","message","Error","super","reason","alert"],"mappings":"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","file":"products-list-index-js-197.js","sourcesContent":["export default class SortableList {\r\n  element;\r\n\r\n  onDocumentPointerMove = ({clientX, clientY}) => {\r\n    this.moveDraggingAt(clientX, clientY);\r\n\r\n    const {firstElementChild, children} = this.element;\r\n    const {top: firstElementTop} = firstElementChild.getBoundingClientRect();\r\n    const {bottom} = this.element.getBoundingClientRect();\r\n\r\n    if (clientY < firstElementTop) {\r\n      this.movePlaceholderAt(0);\r\n    } else if (clientY > bottom) {\r\n      this.movePlaceholderAt(children.length);\r\n    } else {\r\n      for (let i = 0; i < children.length; i++) {\r\n        const li = children[i];\r\n\r\n        // ignore to prevent bugs when dragging between elements\r\n        if (li !== this.draggingElem) {\r\n          const {top, bottom} = li.getBoundingClientRect();\r\n          const {offsetHeight: height} = li;\r\n\r\n          if (clientY > top && clientY < bottom) {\r\n            // inside the element (y-axis)\r\n            if (clientY < top + height / 2) {\r\n              // upper half of the element\r\n              this.movePlaceholderAt(i);\r\n              break;\r\n            } else {\r\n              // lower half of the element\r\n              this.movePlaceholderAt(i + 1);\r\n              break;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    this.scrollIfCloseToWindowEdge(clientY);\r\n  };\r\n\r\n  onDocumentPointerUp = () => {\r\n    this.dragStop();\r\n  };\r\n\r\n  constructor({items = []} = {}) {\r\n    this.items = items;\r\n\r\n    this.render();\r\n  }\r\n\r\n  render() {\r\n    this.element = document.createElement('ul');\r\n    this.element.className = 'sortable-list';\r\n\r\n    this.addItems();\r\n    this.initEventListeners();\r\n  }\r\n\r\n  initEventListeners() {\r\n    this.element.addEventListener('pointerdown', event => this.onPointerDown(event));\r\n  }\r\n\r\n  addItems() {\r\n    // item is a DOM element\r\n    for (let item of this.items) {\r\n      item.classList.add('sortable-list__item');\r\n    }\r\n\r\n    this.element.append(...this.items);\r\n  }\r\n\r\n  onPointerDown(event) {\r\n    if (event.which !== 1) { // must be left-button\r\n      return false;\r\n    }\r\n\r\n    const itemElem = event.target.closest('.sortable-list__item');\r\n\r\n    if (itemElem) {\r\n      if (event.target.closest('[data-grab-handle]')) {\r\n        event.preventDefault();\r\n\r\n        this.dragStart(itemElem, event);\r\n      }\r\n\r\n      if (event.target.closest('[data-delete-handle]')) {\r\n        event.preventDefault();\r\n\r\n        itemElem.remove();\r\n      }\r\n    }\r\n  }\r\n\r\n  dragStart(itemElem, {clientX, clientY}) {\r\n    this.elementInitialIndex = [...this.element.children].indexOf(itemElem);\r\n\r\n    this.pointerInitialShift = {\r\n      x: clientX - itemElem.getBoundingClientRect().x,\r\n      y: clientY - itemElem.getBoundingClientRect().y\r\n    };\r\n\r\n    this.draggingElem = itemElem;\r\n\r\n    this.placeholderElem = document.createElement('li');\r\n    this.placeholderElem.className = 'sortable-list__placeholder';\r\n\r\n    // itemElem will get position:fixed\r\n    // so its width will be auto-set to fit the parent container\r\n    itemElem.style.width = `${itemElem.offsetWidth}px`;\r\n    itemElem.style.height = `${itemElem.offsetHeight}px`;\r\n\r\n    this.placeholderElem.style.width = itemElem.style.width;\r\n    this.placeholderElem.style.height = itemElem.style.height;\r\n\r\n    itemElem.classList.add('sortable-list__item_dragging');\r\n\r\n    itemElem.after(this.placeholderElem);\r\n\r\n    // move to the end, to be over other list elements\r\n    this.element.append(itemElem);\r\n\r\n    this.moveDraggingAt(clientX, clientY);\r\n\r\n    document.addEventListener('pointermove', this.onDocumentPointerMove);\r\n    document.addEventListener('pointerup', this.onDocumentPointerUp);\r\n  }\r\n\r\n  moveDraggingAt(clientX, clientY) {\r\n    this.draggingElem.style.left = clientX - this.pointerInitialShift.x + 'px';\r\n    this.draggingElem.style.top = clientY - this.pointerInitialShift.y + 'px';\r\n  }\r\n\r\n  scrollIfCloseToWindowEdge(clientY) {\r\n    const scrollingValue = 10;\r\n    const threshold = 20;\r\n\r\n    if (clientY < threshold) {\r\n      window.scrollBy(0, -scrollingValue);\r\n    } else if (clientY > document.documentElement.clientHeight - threshold) {\r\n      window.scrollBy(0, scrollingValue);\r\n    }\r\n  }\r\n\r\n  movePlaceholderAt(index) {\r\n    const currentElement = this.element.children[index];\r\n\r\n    if (currentElement !== this.placeholderElem) {\r\n      this.element.insertBefore(this.placeholderElem, currentElement);\r\n    }\r\n  }\r\n\r\n  dragStop() {\r\n    const placeholderIndex = [...this.element.children].indexOf(this.placeholderElem);\r\n\r\n    // drop element back\r\n    this.placeholderElem.replaceWith(this.draggingElem);\r\n    this.draggingElem.classList.remove('sortable-list__item_dragging');\r\n\r\n    this.draggingElem.style.left = '';\r\n    this.draggingElem.style.top = '';\r\n    this.draggingElem.style.width = '';\r\n    this.draggingElem.style.height = '';\r\n\r\n    document.removeEventListener('pointermove', this.onDocumentPointerMove);\r\n    document.removeEventListener('pointerup', this.onDocumentPointerUp);\r\n\r\n    this.draggingElem = null;\r\n\r\n    if (placeholderIndex !== this.elementInitialIndex) {\r\n      this.element.dispatchEvent(new CustomEvent('sortable-list-reorder', {\r\n        bubbles: true,\r\n        details: {\r\n          from: this.elementInitialIndex,\r\n          to: placeholderIndex\r\n        }\r\n      }));\r\n    }\r\n  }\r\n\r\n  remove() {\r\n    this.element.remove();\r\n    document.removeEventListener('pointermove', this.onDocumentPointerMove);\r\n    document.removeEventListener('pointerup', this.onDocumentPointerUp);\r\n  }\r\n\r\n  destroy() {\r\n    this.remove();\r\n  }\r\n}\r\n","export default string => string\r\n  .replace(/&/g, '&amp;')\r\n  .replace(/\"/g, '&quot;')\r\n  .replace(/'/g, '&#39;')\r\n  .replace(/</g, '&lt;')\r\n  .replace(/>/g, '&gt;');\r\n","import SortableList from '../sortable-list/index.js';\r\nimport escapeHtml from '../../utils/escape-html.js';\r\nimport fetchJson from '../../utils/fetch-json.js';\r\n\r\nexport default class ProductForm {\r\n  element;\r\n  subElements = {};\r\n  defaultFormData = {\r\n    title: '',\r\n    description: '',\r\n    quantity: 1,\r\n    subcategory: '',\r\n    status: 1,\r\n    images: [],\r\n    price: 100,\r\n    discount: 0\r\n  };\r\n\r\n  onSubmit = event => {\r\n    event.preventDefault();\r\n\r\n    this.save();\r\n  };\r\n\r\n  uploadImage = () => {\r\n    const fileInput = document.createElement('input');\r\n\r\n    fileInput.type = 'file';\r\n    fileInput.accept = 'image/*';\r\n\r\n    fileInput.onchange = async () => {\r\n      const [file] = fileInput.files;\r\n\r\n      if (file) {\r\n        const formData = new FormData();\r\n        const {uploadImage, imageListContainer} = this.subElements;\r\n\r\n        formData.append('image', file);\r\n\r\n        uploadImage.classList.add('is-loading');\r\n        uploadImage.disabled = true;\r\n\r\n        const result = await fetchJson('https://api.imgur.com/3/image', {\r\n          method: 'POST',\r\n          headers: {\r\n            Authorization: `Client-ID ${process.env.IMGUR_CLIENT_ID}`\r\n          },\r\n          body: formData,\r\n        });\r\n\r\n        imageListContainer.firstElementChild.append(this.getImageItem(result.data.link, file.name));\r\n\r\n        uploadImage.classList.remove('is-loading');\r\n        uploadImage.disabled = false;\r\n\r\n        // Remove input from body\r\n        fileInput.remove();\r\n      }\r\n    };\r\n\r\n    // must be in body for IE\r\n    fileInput.hidden = true;\r\n    document.body.appendChild(fileInput);\r\n    fileInput.click();\r\n  };\r\n\r\n  constructor(productId) {\r\n    this.productId = productId;\r\n  }\r\n\r\n  template() {\r\n    return `\r\n      <div class=\"product-form\">\r\n\r\n      <form data-element=\"productForm\" class=\"form-grid\">\r\n        <div class=\"form-group form-group__half_left\">\r\n          <fieldset>\r\n            <label class=\"form-label\">Название товара</label>\r\n            <input required\r\n              id=\"title\"\r\n              value=\"\"\r\n              type=\"text\"\r\n              name=\"title\"\r\n              class=\"form-control\"\r\n              placeholder=\"Название товара\">\r\n          </fieldset>\r\n        </div>\r\n\r\n        <div class=\"form-group form-group__wide\">\r\n          <label class=\"form-label\">Описание</label>\r\n          <textarea required\r\n            id=\"description\"\r\n            class=\"form-control\"\r\n            name=\"description\"\r\n            placeholder=\"Описание товара\"></textarea>\r\n        </div>\r\n\r\n        <div class=\"form-group form-group__wide\">\r\n          <label class=\"form-label\">Фото</label>\r\n\r\n          <div data-element=\"imageListContainer\"></div>\r\n\r\n          <button data-element=\"uploadImage\" type=\"button\" class=\"button-primary-outline\">\r\n            <span>Загрузить</span>\r\n          </button>\r\n        </div>\r\n\r\n        <div class=\"form-group form-group__half_left\">\r\n          <label class=\"form-label\">Категория</label>\r\n            ${this.createCategoriesSelect()}\r\n        </div>\r\n\r\n        <div class=\"form-group form-group__half_left form-group__two-col\">\r\n          <fieldset>\r\n            <label class=\"form-label\">Цена ($)</label>\r\n            <input required\r\n              id=\"price\"\r\n              value=\"\"\r\n              type=\"number\"\r\n              name=\"price\"\r\n              class=\"form-control\"\r\n              placeholder=\"${this.defaultFormData.price}\">\r\n          </fieldset>\r\n          <fieldset>\r\n            <label class=\"form-label\">Скидка ($)</label>\r\n            <input required\r\n              id=\"discount\"\r\n              value=\"\"\r\n              type=\"number\"\r\n              name=\"discount\"\r\n              class=\"form-control\"\r\n              placeholder=\"${this.defaultFormData.discount}\">\r\n          </fieldset>\r\n        </div>\r\n\r\n        <div class=\"form-group form-group__part-half\">\r\n          <label class=\"form-label\">Количество</label>\r\n          <input required\r\n            id=\"quantity\"\r\n            value=\"\"\r\n            type=\"number\"\r\n            class=\"form-control\"\r\n            name=\"quantity\"\r\n            placeholder=\"${this.defaultFormData.quantity}\">\r\n        </div>\r\n\r\n        <div class=\"form-group form-group__part-half\">\r\n          <label class=\"form-label\">Статус</label>\r\n          <select id=\"status\" class=\"form-control\" name=\"status\">\r\n            <option value=\"1\">Активен</option>\r\n            <option value=\"0\">Неактивен</option>\r\n          </select>\r\n        </div>\r\n\r\n        <div class=\"form-buttons\">\r\n          <button type=\"submit\" name=\"save\" class=\"button-primary-outline\">\r\n            ${this.productId ? 'Сохранить' : 'Добавить'} товар\r\n          </button>\r\n        </div>\r\n      </form>\r\n    </div>\r\n    `;\r\n  }\r\n\r\n  async render() {\r\n    const categoriesPromise = this.loadCategoriesList();\r\n    const productPromise = this.productId\r\n      ? this.loadProductData(this.productId)\r\n      : Promise.resolve([this.defaultFormData]);\r\n\r\n    const [categoriesData, productResponse] = await Promise.all([categoriesPromise, productPromise]);\r\n    const [productData] = productResponse;\r\n\r\n    this.formData = productData;\r\n    this.categories = categoriesData;\r\n\r\n    this.renderForm();\r\n    this.setFormData();\r\n    this.createImagesList();\r\n    this.initEventListeners();\r\n\r\n    return this.element;\r\n  }\r\n\r\n  renderForm() {\r\n    const element = document.createElement('div');\r\n\r\n    element.innerHTML = this.formData\r\n      ? this.template()\r\n      : this.getEmptyTemplate();\r\n\r\n    this.element = element.firstElementChild;\r\n    this.subElements = this.getSubElements(element);\r\n  }\r\n\r\n  getEmptyTemplate() {\r\n    return `<div>\r\n      <h1 class=\"page-title\">Страница не найдена</h1>\r\n      <p>Извините, данный товар не существует</p>\r\n    </div>`;\r\n  }\r\n\r\n  async save() {\r\n    const product = this.getFormData();\r\n    const result = await fetchJson(`${process.env.BACKEND_URL}api/rest/products`, {\r\n      method: 'PATCH',\r\n      headers: {\r\n        'Content-Type': 'application/json'\r\n      },\r\n      body: JSON.stringify(product)\r\n    });\r\n\r\n    this.dispatchEvent(result.id);\r\n  }\r\n\r\n  getFormData() {\r\n    const {productForm, imageListContainer} = this.subElements;\r\n    const excludedFields = ['images'];\r\n    const formatToNumber = ['price', 'quantity', 'discount', 'status'];\r\n    const fields = Object.keys(this.defaultFormData).filter(item => !excludedFields.includes(item));\r\n    const values = {};\r\n\r\n    for (const field of fields) {\r\n      values[field] = formatToNumber.includes(field)\r\n        ? parseInt(productForm[field].value)\r\n        : productForm[field].value;\r\n    }\r\n\r\n    const imagesHTMLCollection = imageListContainer.querySelectorAll('.sortable-table__cell-img');\r\n\r\n    values.images = [];\r\n    values.id = this.productId;\r\n\r\n    for (const image of imagesHTMLCollection) {\r\n      values.images.push({\r\n        url: image.src,\r\n        source: image.alt\r\n      });\r\n    }\r\n\r\n    return values;\r\n  }\r\n\r\n  dispatchEvent(id) {\r\n    const event = this.productId\r\n      ? new CustomEvent('product-updated', {detail: id})\r\n      : new CustomEvent('product-saved');\r\n\r\n    this.element.dispatchEvent(event);\r\n  }\r\n\r\n  setFormData() {\r\n    const {productForm} = this.subElements;\r\n    const excludedFields = ['images'];\r\n    const fields = Object.keys(this.defaultFormData).filter(item => !excludedFields.includes(item));\r\n\r\n    fields.forEach(item => {\r\n      const element = productForm.querySelector(`#${item}`);\r\n\r\n      element.value = this.formData[item] || this.defaultFormData[item];\r\n    });\r\n  }\r\n\r\n  async loadProductData(productId) {\r\n    return await fetchJson(`${process.env.BACKEND_URL}api/rest/products?id=${productId}`);\r\n  }\r\n\r\n  async loadCategoriesList() {\r\n    return await fetchJson(`${process.env.BACKEND_URL}api/rest/categories?_sort=weight&_refs=subcategory`);\r\n  }\r\n\r\n  createCategoriesSelect() {\r\n    const wrapper = document.createElement('div');\r\n\r\n    wrapper.innerHTML = '<select class=\"form-control\" id=\"subcategory\" name=\"subcategory\"></select>';\r\n\r\n    const select = wrapper.firstElementChild;\r\n\r\n    for (const category of this.categories) {\r\n      for (const child of category.subcategories) {\r\n        select.append(new Option(`${category.title} > ${child.title}`, child.id));\r\n      }\r\n    }\r\n\r\n    return select.outerHTML;\r\n  }\r\n\r\n  getSubElements(element) {\r\n    const subElements = {};\r\n    const elements = element.querySelectorAll('[data-element]');\r\n\r\n    for (const item of elements) {\r\n      subElements[item.dataset.element] = item;\r\n    }\r\n\r\n    return subElements;\r\n  }\r\n\r\n  createImagesList() {\r\n    const {imageListContainer} = this.subElements;\r\n    const {images} = this.formData;\r\n\r\n    const items = images.map(({url, source}) => this.getImageItem(url, source));\r\n\r\n    const sortableList = new SortableList({\r\n      items\r\n    });\r\n\r\n    imageListContainer.append(sortableList.element);\r\n  }\r\n\r\n  getImageItem(url, name) {\r\n    const wrapper = document.createElement('div');\r\n\r\n    wrapper.innerHTML = `\r\n      <li class=\"products-edit__imagelist-item sortable-list__item\">\r\n        <span>\r\n          <img src=\"icon-grab.svg\" data-grab-handle alt=\"grab\">\r\n          <img class=\"sortable-table__cell-img\" alt=\"${escapeHtml(name)}\" src=\"${escapeHtml(url)}\">\r\n          <span>${escapeHtml(name)}</span>\r\n        </span>\r\n\r\n        <button type=\"button\">\r\n          <img src=\"icon-trash.svg\" alt=\"delete\" data-delete-handle>\r\n        </button>\r\n      </li>`;\r\n\r\n    return wrapper.firstElementChild;\r\n  }\r\n\r\n  initEventListeners() {\r\n    const {productForm, uploadImage} = this.subElements;\r\n\r\n    productForm.addEventListener('submit', this.onSubmit);\r\n    uploadImage.addEventListener('click', this.uploadImage);\r\n  }\r\n\r\n  destroy() {\r\n    this.remove();\r\n    this.element = null;\r\n    this.subElements = null;\r\n  }\r\n\r\n  remove() {\r\n    this.element.remove();\r\n  }\r\n}\r\n","import ProductForm from \"../../../components/product-form\";\r\n\r\nexport default class Page {\r\n  element;\r\n  subElements = {};\r\n  components = {};\r\n\r\n  async render() {\r\n    const element = document.createElement('div');\r\n\r\n    element.innerHTML = `\r\n      <div>\r\n        <h1>List page</h1>\r\n      </div>`;\r\n\r\n    this.element = element.firstElementChild;\r\n\r\n    this.initComponents();\r\n    await this.renderComponents();\r\n\r\n    return this.element;\r\n  }\r\n\r\n  initComponents() {\r\n    const productId = '101-planset-lenovo-yt3-x90l-64-gb-3g-lte-cernyj';\r\n\r\n    this.components.productFrom = new ProductForm(productId);\r\n  }\r\n\r\n  async renderComponents() {\r\n    const element = await this.components.productFrom.render();\r\n\r\n    this.element.append(element);\r\n  }\r\n\r\n  destroy() {\r\n    for (const component of Object.values(this.components)) {\r\n      component.destroy();\r\n    }\r\n  }\r\n}\r\n","// same as fetch, but throws FetchError in case of errors\r\n// status >= 400 is an error\r\n// network error / json error are errors\r\n\r\nexport default async function(url, params) {\r\n  let response;\r\n\r\n  try {\r\n    // NOTE: \"toString\" call needed for correct work of \"jest-fetch-mock\"\r\n    response = await fetch(url.toString(), params);\r\n  } catch(err) {\r\n    throw new FetchError(response, \"Network error has occurred.\");\r\n  }\r\n\r\n  let body;\r\n\r\n  if (!response.ok) {\r\n    let errorText = response.statusText; // Not Found (for 404)\r\n\r\n    try {\r\n      body = await response.json();\r\n\r\n      errorText = (body.error && body.error.message) || (body.data && body.data.error && body.data.error.message) || errorText;\r\n    } catch (error) { /* ignore failed body */ }\r\n\r\n    let message = `Error ${response.status}: ${errorText}`;\r\n\r\n    throw new FetchError(response, body, message);\r\n  }\r\n\r\n  try {\r\n    return await response.json();\r\n  } catch(err) {\r\n    throw new FetchError(response, null, err.message);\r\n  }\r\n}\r\n\r\nexport class FetchError extends Error {\r\n  name = \"FetchError\";\r\n\r\n  constructor(response, body, message) {\r\n    super(message);\r\n    this.response = response;\r\n    this.body = body;\r\n  }\r\n}\r\n\r\n// handle uncaught failed fetch through\r\nwindow.addEventListener('unhandledrejection', event => {\r\n  if (event.reason instanceof FetchError) {\r\n    alert(event.reason.message);\r\n  }\r\n});\r\n\r\n"],"sourceRoot":""}